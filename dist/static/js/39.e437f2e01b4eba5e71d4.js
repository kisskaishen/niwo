webpackJsonp([39],{kEUl:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o("IHPB"),r=o.n(a),d=o("KKrt"),l={name:"businessAdd",data:function(){var e=/^\d{6,10}$/;return{addData:{proLine:"",proFlow:"",flowCode:"",remark:""},newVerson:"",getVerson:"",proSelectList:[],proFlowList:[],addRules:{proLine:[{required:!0,message:"请选择产品线",trigger:"change"}],proFlow:[{required:!0,message:"请选择流程",trigger:"change"}],flowCode:[{required:!0,validator:function(t,o,a){return console.log(o),console.log(o>99999),o?e.test(o)?o<1e5?a(new Error("流程编码首位不能为0")):void a():a(new Error("流程编码必须是6-10位数字")):a(new Error("请填写流程编码"))},trigger:"blur"}]}}},beforeCreate:function(){"look"==this.$route.query.type?this.$route.meta.title="查看流程":"copy"==this.$route.query.type?this.$route.meta.title="复制流程":this.$route.meta.title="新增流程",document.title=this.$route.meta.title},mounted:function(){this.getProList(),"copy"==this.$route.query.type&&(this.addData.proLine=this.$route.query.appId,this.getFlowList())},methods:{getProList:function(){var e=this;this.$post("/mcs/product/list",{pageNo:"-1",productName:""}).then(function(t){e.proSelectList=t.productList})},getFlowList:function(){var e=this;this.$post("/mcs/mold/process/code/list",{appId:this.addData.proLine}).then(function(t){e.proFlowList=[].concat([{id:"-1",moldCode:"",moldName:"添加新的流程名称",moldType:"",moldVersion:"",nodeId:null}],r()(t.moldList))})},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){e?(console.log(e),"copy"==t.$route.query.type?t.$post("/mcs/mold/process/copy",{originMoldId:t.$route.query.flowId,referMoldId:"-1"==t.addData.proFlow?"":t.addData.proFlow,moldName:"-1"==t.addData.proFlow?t.newVerson:"",moldCode:"-1"==t.addData.proFlow?t.addData.flowCode:"",remark:t.addData.remark}).then(function(e){d.a.message("success","复制成功~"),t.$router.push({path:"/risk/proMg/businessList/editFlow",query:{appId:e.appId,type:"edit",moldType:e.moldType,flowId:e.id,referMoldId:e.referMoldId}})}):t.$post("/mcs/mold/process/create",{appId:t.addData.proLine,moldName:t.newVerson,referMoldId:"-1"==t.addData.proFlow?"":t.addData.proFlow,moldCode:t.addData.flowCode,remark:t.addData.remark}).then(function(e){d.a.message("success","添加成功~"),t.$router.push({path:"/risk/proMg/businessList/editFlow",query:{appId:e.appId,type:"edit",moldType:e.moldType,flowId:e.id,referMoldId:e.referMoldId}})})):d.a.message("error","请填写必填项！")})},resetForm:function(e){this.$refs[e].resetFields()}},watch:{"addData.proLine":function(e){""!=e&&this.getFlowList()},"addData.proFlow":function(e){var t=this;this.proFlowList.map(function(o){o.id==e&&(t.getVerson=o.moldVersion)})}}},s={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"businessAdd"},[o("el-form",{ref:"addForm",attrs:{model:e.addData,rules:e.addRules,"label-width":"120px"}},[o("el-form-item",{attrs:{label:"选择产品线：",prop:"proLine"}},["copy"!=e.$route.query.type?o("el-select",{attrs:{placeholder:"请选择产品线"},model:{value:e.addData.proLine,callback:function(t){e.$set(e.addData,"proLine",t)},expression:"addData.proLine"}},e._l(e.proSelectList,function(e,t){return o("el-option",{key:t,attrs:{label:e.productName,value:e.appId}})})):o("span",[e._v(e._s(e.$route.query.productName))])],1),e._v(" "),o("el-form-item",{attrs:{label:"选择流程：",prop:"proFlow"}},[o("el-select",{attrs:{placeholder:"请选择流程"},model:{value:e.addData.proFlow,callback:function(t){e.$set(e.addData,"proFlow",t)},expression:"addData.proFlow"}},e._l(e.proFlowList,function(e,t){return o("el-option",{key:t,attrs:{label:e.moldName,value:e.id}})})),e._v(" "),"-1"==e.addData.proFlow?o("el-input",{attrs:{placeholder:"请添加新的流程名称",maxLength:"15"},model:{value:e.newVerson,callback:function(t){e.newVerson=t},expression:"newVerson"}}):"-1"!=e.addData.proFlow&&e.addData.proFlow?o("span",{staticStyle:{"margin-left":"20px"}},[e._v("版本号：V"+e._s(e.getVerson))]):e._e()],1),e._v(" "),e.addData.proFlow&&"-1"!=e.addData.proFlow?e._e():o("el-form-item",{attrs:{label:"流程编码：",prop:"flowCode"}},[o("el-input",{attrs:{placeholder:"请填写流程编码,支持6-10位数字"},model:{value:e.addData.flowCode,callback:function(t){e.$set(e.addData,"flowCode",t)},expression:"addData.flowCode"}})],1),e._v(" "),o("el-form-item",{staticClass:"moldRemark",attrs:{label:"备注信息："}},[o("el-input",{class:{"is-error":255==e.addData.remark.length},attrs:{type:"textarea",rows:5,maxlength:"255",autosize:{minRows:3,maxRows:6},placeholder:"请填写备注信息"},model:{value:e.addData.remark,callback:function(t){e.$set(e.addData,"remark",t)},expression:"addData.remark"}}),e._v(" "),e.addData.remark?o("div",{staticClass:"counter f12 lh15",class:e.addData.remark.length>=255?"f_red":"f_ccc"},[e._v(e._s(e.addData.remark.length)+"/255\n            ")]):e._e()],1),e._v(" "),o("el-form-item",{staticClass:"modelAdd_submite",attrs:{label:""}},[o("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("addForm")}}},[e._v("保存")])],1)],1)],1)},staticRenderFns:[]};var i=o("C7Lr")(l,s,!1,function(e){o("kceU")},"data-v-55bffeb6",null);t.default=i.exports},kceU:function(e,t){}});