webpackJsonp([24],{Rmon:function(t,e){},scAe:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i("3cXf"),s=i.n(r),a=i("Mn3y"),o={plus:i("hSzm"),remove:i("ZRMD"),sort:i("n13j"),ruleConOpen:i("k19Z"),arrowLeft:i("Oglh")},l={name:"parallelForm_stratForm",data:function(){return{pageName:"pages_stratForm",icon:o,show:{stratName:!0,ruleForm:!1},policyList:[],variableList:[],allEnmuList:[],oprList:[{id:1,name:"="},{id:2,name:"!="},{id:3,name:"is null"},{id:4,name:">"},{id:5,name:">="},{id:6,name:"<"},{id:7,name:"<="},{id:8,name:"startsWith"},{id:9,name:"contains"}],oprList_str:[{id:1,name:"="},{id:2,name:"!="},{id:3,name:"is null"},{id:8,name:"startsWith"},{id:9,name:"contains"}],oprList_num:[{id:1,name:"="},{id:2,name:"!="},{id:4,name:">"},{id:5,name:">="},{id:6,name:"<"},{id:7,name:"<="}],oprList_bl:[{id:"1",name:"是"},{id:"0",name:"否"}],hitList:[{id:0,name:"通过"},{id:1,name:"拒绝"},{id:2,name:"人工审核"},{id:3,name:"继续执行"}],stratForm:{policyType:!1,nodeId:"",appId:"",policyName:"",rate:"",policyId:"",logic:"",missThen:"",hitThen:"",exceptionThen:"",ruleList:""},vLock:!1,isNewNode:!0,stratLoading:!0,policyListFilter:[],isDisabled:!1}},props:["policyType","appId","variableListUml","policyListUml"],components:{ruleItem:a.a},created:function(){this.variableList=this.variableListUml,this.policyListFilter=this.policyList=this.policyListUml?this.policyListUml:[],this.getPolicyList(),this.stratForm.appId=this.$route.query.appId,"edit"==this.$route.query.type&&this.$route.query.policyId&&(console.log("如果有policyId,直接请求策略详情"),this.stratForm.policyId=this.$route.query.policyId,this.getPolicyDetail()),this.getOprList_enumList()},methods:{getPolicyList:function(){var t=this;!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.$post("/mcs/policy/template/list",{appId:this.$route.query.appId,policyName:"",pageNo:"",pageSize:999,statusOrder:2}).then(function(e){t.policyList=e.policyList,t.policyListFilter=e.policyList,t.initData()})},initData:function(){this.$route.name.indexOf("_stratForm")>-1?(this.stratForm.policyId=this.$route.query.policyId,this.stratAdd2()):"stratAdd"==this.$route.name?this.stratAdd():"stratEdit"==this.$route.name?this.getPolicyDetail():this.getPolicyNode(),this.stratLoading=!1},stratAdd:function(){var t=this;this.$refs.policyName.blur(),this.show.stratName=!1,this.resetStratForm(),this.$nextTick(function(){t.$refs.ruleItem.rule_plus()})},stratAdd2:function(){var t=this;this.$route.query.policyId=this.stratForm.policyId,this.show.stratName=!1,this.resetStratForm(),this.$nextTick(function(){t.$refs.ruleItem.rule_plus()}),this.$route.query.policyType&&(this.stratForm.policyType=this.$route.query.policyType)},arrowLeft:function(){this.$route.name.indexOf("_stratForm")>-1?(this.$router.push({query:this.$route.query}),this.$router.go(-1)):(this.show.stratName=!0,this.$route.query.policyId?(this.stratForm.policyId=this.$route.query.policyId,this.changeStratName(this.$route.query.policyId),delete this.$route.query.policyId):this.stratForm.policyId="")},changeStratName:function(t){var e=this;this.policyList.map(function(i){i.id==t&&(e.stratForm.policyName=i.policyName)}),this.getPolicyDetail(),this.$nextTick(function(){e.show.stratName=!1})},validateStrat:function(){var t=this;this.vLock=!0;var e=this.stratForm.ruleList.filter(function(e){var i=t.$refs.ruleItem.validateRule(e);return!!e.ruleName&&!!e.logic&&i}).length;return!!this.stratForm.policyName&&this.stratForm.logic&&e==this.stratForm.ruleList.length&&("stratForm"!=t.$route.name&&"parallelForm_stratForm"!=t.$route.name||!t.stratForm.policyId||""!==t.stratForm.missThen&&""!==t.stratForm.hitThen&&""!==t.stratForm.exceptionThen)},saveStrat:function(t){if(this.validateStrat())console.log("验证通过"),console.log(this.stratForm),this.stratForm.policyType?(this.createPolicy(),this.policyList.push(this.stratForm),console.log(this.policyList)):console.log(123);else{var e="";e=""==this.stratForm.policyName?"请输入策略名称":""==this.stratForm.logic?"请选择策略执行条件":"请填写相关必填项",this.$notify({message:e,type:"warning",customClass:"pos-stratForm1"})}},createPolicy:function(){var t=this;this.stratForm.appId=this.appId?this.appId:this.$route.query.appId;var e=JSON.parse(s()(this.stratForm));e.ruleList.map(function(t){t.id=""}),e.policyType=1==e.policyType?"0":"1","stratAdd"==this.$route.name&&(e.policyType=0),this.$post("/mcs/policy/create",e).then(function(i){t.$message.success("创建成功"),t.$router.push({path:"/risk/modelMg/modelUml/parallelForm",query:t.$route.query}),t.$emit("createCelueSuccess",e,t.policyList)})},resetStratForm:function(){this.stratForm={appId:this.$route.query.appId,policyName:"",policyId:"",logic:"",missThen:"",hitThen:"",exceptionThen:"",ruleList:[],policyType:!1,policyShow:!0},this.vLock=!1},ruleAdd:function(){this.$router.push({path:this.$route.path+"/ruleForm",query:this.$route.query})},pushRule:function(t){console.log("策略中新增规则"),this.stratForm.ruleList=this.stratForm.ruleList.filter(function(t){return!!t.ruleName}),console.log("保存规则到策略模板",this.$route.query),this.$refs.ruleItem.ruleTmplList.push(t),this.stratForm.ruleList.push(t),this.$router.push({query:this.$route.query}),this.$router.go(-1)},getVarType:function(t,e,i){var r=this;this.variableList.map(function(e){t.variableId==e.variableId&&(t.variableName=e.variableName,t.variableType=e.variableType,1==e.variableType?t.oprList=r.oprList_str:2==e.variableType||3==e.variableType||4==e.variableType?t.oprList=r.oprList_num:5==e.variableType?(t.oprList=[],r.allEnmuList.map(function(e){t.variableId==e.variableId&&(e.id=e.enumValue,e.name=e.enumName,t.oprList.push(e),console.log(t.oprList))})):6==e.variableType?t.oprList=r.oprList_bl:r.$notify({message:"未知变量",type:"warning"}))})},getOprList_enumList:function(){var t=this;this.$post("/mcs/variable/enum/list",{}).then(function(e){t.allEnmuList=e.enumList})},operation:function(t){switch(t){case 1:return"=";case 2:return"!=";case 3:return"is null";case 4:return">";case 5:return">=";case 6:return"<";case 7:return"<=";case 8:return"startsWith";case 9:return"contains"}}}},n={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"pages_stratForm"},[i("div",{directives:[{name:"show",rawName:"v-show",value:-1==t.$route.name.indexOf("_ruleForm"),expression:"$route.name.indexOf('_ruleForm')==-1"}]},[i("el-form",{ref:"stratForm",staticClass:"stratForm",attrs:{model:t.stratForm,"status-icon":""}},["stratAdd"==t.$route.name||!t.$route.query.moldType&&"stratEdit"==t.$route.name?t._e():i("img",{staticClass:"backTostratName pointer",attrs:{src:t.icon.arrowLeft,alt:"返回策略名称"},on:{click:t.arrowLeft}}),t._v(" "),i("el-form-item",{attrs:{label:""}},["look"==t.$route.query.type?i("div",{staticClass:"w300 overhide"},[t._v("\n                    "+t._s(t.stratForm.policyName)+"\n                ")]):i("el-input",{staticClass:"w310",class:{solid_red:t.vLock&&!t.stratForm.policyName},attrs:{placeholder:"请输入策略名称",size:"medium",clearable:""},model:{value:t.stratForm.policyName,callback:function(e){t.$set(t.stratForm,"policyName",e)},expression:"stratForm.policyName"}})],1),t._v(" "),i("div",{staticClass:"stratForm_rule mg_t_20"},[i("el-form-item",{attrs:{label:"策略执行条件：",prop:"logic"}},[i("el-radio-group",{class:{solid_red:t.vLock&&!t.stratForm.logic},model:{value:t.stratForm.logic,callback:function(e){t.$set(t.stratForm,"logic",t._n(e))},expression:"stratForm.logic"}},[i("el-radio",{attrs:{label:2}},[t._v("满足任意条件")]),t._v(" "),i("el-radio",{attrs:{label:1}},[t._v("满足全部条件")])],1)],1),t._v(" "),i("el-form-item",{staticClass:"stratForm_bd"},[i("ruleItem",{ref:"ruleItem",attrs:{icon:t.icon,variableList:t.variableList,ruleTmplListUml:[],ruleList:t.stratForm.ruleList,show:t.show,vLock:t.vLock,appId:t.appId},on:{getVarType:t.getVarType}})],1),t._v(" "),i("el-form-item",{staticClass:"policyType",attrs:{label:""}},[i("el-checkbox",{model:{value:t.stratForm.policyType,callback:function(e){t.$set(t.stratForm,"policyType",e)},expression:"stratForm.policyType"}},[t._v("保存为策略模板")])],1)],1),t._v(" "),i("div",{staticClass:"modelBtn"},["edit"==t.$route.query.type?i("div",[i("el-button",{attrs:{type:"primary",size:"medium"},on:{click:function(e){t.saveStrat()}}},[t._v("保存")])],1):t._e()])],1)],1),t._v(" "),i("router-view",{attrs:{icon:t.icon,variableList:t.variableList,appId:t.appId},on:{createRuleSuccess:t.pushRule,getVarType:t.getVarType}})],1)},staticRenderFns:[]};var c=i("C7Lr")(l,n,!1,function(t){i("Rmon")},"data-v-ca99777e",null);e.default=c.exports}});