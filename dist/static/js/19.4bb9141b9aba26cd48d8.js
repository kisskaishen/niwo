webpackJsonp([19],{JuTK:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAABIUlEQVQ4T6VSsXHDMAzEqxBbjaARtEGcDTKCVYHsMoIyQdLxWMkbxCMoG3gDewS3VCHkoIg6hpdcirCSSDzwj39QccZxbGKMDwA6fRKRizHmo+/7e16K/CeEMIjIExFNAG5E1BBRS0QHIhqZ+SXV78AQwklE7saYoeyuLOZ5fhMRsdb2Cl6B26TGWvtcUi8YnYjoxswDNk2TtXbVlI42028tSnfb5Etd1x2898eqqtq8ILEogdu9Tj1DOy/LMjnnpr8m5g3/BdT1dyVV773aQM45tSXX/kX1t+V479U7Be4S0nKYud3tKBfxE1C93u3I1q+X1zwduQ0xxlcAYObjHoDcO40cgHfN6FoAHETkEcA538O3rGrhpkP1pUCo4VMZw085Xb3IhouADgAAAABJRU5ErkJggg=="},YvKs:function(e,t){},fYHi:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("aA9S"),l=i.n(a),r=i("3cXf"),s=i.n(r),o=i("+5dV"),n={warn:i("JuTK"),sort:i("n13j"),arrowLeft:i("Oglh")},p={name:"pages_parallelForm",data:function(){return{pageName:"pages_parallelForm",icon:n,show:{},parallelForm:{nodeId:"",nodeName:"",parallelName:"并行",decisions:[{condition:1,result:1,decision:0,sort:1},{condition:1,result:0,decision:0,sort:2},{condition:0,result:1,decision:0,sort:3},{condition:1,result:-1,decision:0,sort:4},{condition:0,result:1,decision:0,sort:5}],policyList:[]},decisionList:[{id:0,name:"通过"},{id:1,name:"拒绝"},{id:2,name:"人工审核"},{id:3,name:"继续执行"}],conResultList:[{id:1,name:"任意策略命中"},{id:0,name:"任意策略未命中"}],vLock:!1,isNewNode:!0,variableList:[],oprList:[{id:1,name:"="},{id:2,name:"!="},{id:3,name:"is null"},{id:4,name:">"},{id:5,name:">="},{id:6,name:"<"},{id:7,name:"<="},{id:8,name:"startsWith"},{id:9,name:"contains"}],oprList_str:[{id:1,name:"="},{id:2,name:"!="},{id:3,name:"is null"},{id:8,name:"startsWith"},{id:9,name:"contains"}],oprList_num:[{id:1,name:"="},{id:2,name:"!="},{id:4,name:">"},{id:5,name:">="},{id:6,name:"<"},{id:7,name:"<="}],oprList_bl:[{id:"1",name:"是"},{id:"0",name:"否"}]}},props:["variableListUml"],components:{policyItem:o.a},created:function(){this.variableList=this.variableListUml,this.variableListUml.length?this.getParallelNode():this.getVariableList()},methods:{classify_plus:function(){this.parallelForm.policyList.push({appId:"",id:"",policyName:"",logic:"",policyShow:!0,ruleList:[{id:"",ruleName:"",decisionCode:"",logic:"",ruleConShow:!1,ruleContent:[{variableId:"",variableName:"",variableType:"",logic:1,oprList:[],operationArray:[],content:[{operation:"",operationValue:"",valueDescription:"",sort:""}]}]}]})},classify_remove:function(e,t){this.parallelForm.policyList.splice(t,1),this.parallelForm.policyList.length<1&&(this.classify_plus(e,t),!e.policyName&&this.$notify({message:"不能再删了",type:"warning"}))},validateParallelForm:function(){var e=this;this.vLock=!0;var t=this.parallelForm.policyList.filter(function(t){var i=!t.policyShow||e.$refs.policyItem.validateStrat(t);return console.log(888,e.$refs.policyItem.validateStrat(t)),t.id&&i}).length;return console.log("完整Classify",t,"所有Classify",this.parallelForm.policyList.length),!!this.parallelForm.parallelName&&t==this.parallelForm.policyList.length},bindParallel:function(){var e=this;if(this.validateParallelForm()){var t=JSON.parse(s()(this.parallelForm));t.nodeId=this.$route.query.nodeId.slice(4),t.policyList.map(function(e,t){e.id="",e.ruleList.map(function(e,t){e.id=""})}),this.$post("/mcs/node/parallel/bind",t).then(function(i){e.$message.success("绑定成功"),t.nodeName=e.parallelForm.parallelName,t.nodeId=e.$route.query.nodeId,e.$emit("saveForm",t),e.resetParallelForm()})}else this.$notify({message:"并行信息不完整",type:"warning",customClass:"pos-parallelForm"})},resetParallelForm:function(){this.parallelForm={parallelName:"",decisions:[{condition:1,result:1,decision:0,sort:1},{condition:1,result:0,decision:0,sort:2},{condition:0,result:1,decision:0,sort:3},{condition:1,result:-1,decision:0,sort:4},{condition:0,result:1,decision:0,sort:5}],policyList:[]},this.classify_plus(),this.vLock=!1},getParallelNode:function(e,t){var i=this;this.$post("/mcs/node/parallel/query",{nodeId:this.$route.query.nodeId.slice(4)}).then(function(e){e&&e.policyList?(e.policyList.sort(function(e,t){return e.sort-t.sort}),e.decisions.sort(function(e,t){return e.sort-t.sort}),e.policyList.map(function(e){e.policyShow=!1,e.id=e.policyName,e.ruleList.map(function(e,t){e.ruleConShow=!1,e.ruleContent.map(function(e,a){e.operationArray=e.content.map(function(e){return e.operationValue}),e.variableType="",e.oprList=[],i.getVarType(e,a,t)}),e.isTemplate||(e.id=e.ruleName)})}),l()(i.parallelForm,e)):i.classify_plus();var t=JSON.parse(s()(i.parallelForm));t.nodeName=i.parallelForm.parallelName,t.nodeId=i.$route.query.nodeId,t.clear=!e,i.$emit("firstBindPush",t)})},stratAdd:function(){var e=this.$route.query;e.policyType=3,this.$router.push({path:"/risk/proMg/businessList/editFlow/parallelForm/stratForm",query:e})},pushStrat:function(e){this.parallelForm.policyList=this.parallelForm.policyList.filter(function(e){return!!e.policyName}),e.id=e.policyName,this.parallelForm.policyList.push(e),this.$router.push({path:"/risk/proMg/businessList/editFlow/parallelForm",query:this.$route.query})},pushRule:function(e){var t=this;console.log("并行中策略中新增规则：未完成",this.$route.query.policyIndex),this.parallelForm.policyList.map(function(i,a){a==t.$route.query.policyIndex&&(i.ruleList=i.ruleList.filter(function(e){return!!e.ruleName}),console.log("保存规则到策略模板",t.$route.query,t.$refs),e.id=e.ruleName,t.$refs.policyItem.$refs.ruleItem.map(function(t,i){t.ruleTmplList.push(e)}),i.ruleList.push(e),delete t.$route.query.policyIndex,t.$router.push({query:t.$route.query}),t.$router.go(-1))})},getVariableList:function(e){var t=this;this.$post("/mcs/variable/config/list",{appId:this.$route.query.appId}).then(function(e){t.variableList=e.variableList,t.getParallelNode()})},getVarType:function(e,t,i){var a=this;this.variableList.map(function(l){e.variableId==l.variableId&&(e.variableName=l.variableName,e.variableType=l.variableType,1==l.variableType?e.oprList=a.oprList_str:2==l.variableType||3==l.variableType||4==l.variableType?e.oprList=a.oprList_num:5==l.variableType?a.getOprList_enumList(e,t,i):6==l.variableType?e.oprList=a.oprList_bl:a.$notify({message:"未知变量",type:"warning"}))})},getOprList_enumList:function(e,t,i){this.$post("/mcs/variable/enums",{variableId:e.variableId}).then(function(t){t.enumList.map(function(e){e.id=e.enumValue,e.name=e.enumName}),e.oprList=t.enumList})}}},c={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"pages_parallelForm"},[i("el-form",{directives:[{name:"show",rawName:"v-show",value:"parallelForm"==e.$route.name,expression:"$route.name=='parallelForm'"}],ref:"parallelForm",staticClass:"parallelForm pd_t_20",attrs:{model:e.parallelForm,"status-icon":""}},[i("el-form-item",{attrs:{label:""}},["look"==e.$route.query.type?i("div",{staticClass:"w300 overhide"},[e._v("\n                "+e._s(e.parallelForm.parallelName)+"\n            ")]):i("el-input",{staticClass:"w310",class:{solid_red:e.vLock&&!e.parallelForm.parallelName},attrs:{placeholder:"请输入并行名称",size:"medium",clearable:""},model:{value:e.parallelForm.parallelName,callback:function(t){e.$set(e.parallelForm,"parallelName",t)},expression:"parallelForm.parallelName"}})],1),e._v(" "),i("div",{staticClass:"parallelForm_sug"},[i("p",{staticClass:"sug_title"},[e._v("决策意见："),"edit"==e.$route.query.type?i("span",{staticClass:"f12 f_999"},[e._v("位置可拖拽移动")]):e._e()]),e._v(" "),e._l(e.parallelForm.decisions,function(t,a){return i("el-form-item",{key:a,attrs:{"label-width":"0px"}},[(e.isNewNode?3==t.sort:1==t.condition&&-1!=t.result)?i("el-select",{staticClass:"w150",attrs:{"popper-append-to-body":!0,placeholder:"请选择",size:"medium","no-match-text":"查询无结果","no-data-text":"暂无数据","popper-class":"stratList conResult",disabled:"look"==e.$route.query.type},model:{value:t.result,callback:function(i){e.$set(t,"result",e._n(i))},expression:"item.result"}},e._l(e.conResultList,function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})})):i("span",{staticClass:"w150 inlineBlock text-right"},[e._v("\n            \t\t"+e._s(0==t.condition?"任意":"全部")+"策略"+e._s(0==t.result?"未命中":1==t.result?"命中":"异常")+"：\n            \t")]),e._v(" "),i("el-select",{staticClass:"w150",attrs:{"popper-append-to-body":!0,placeholder:"请选择",size:"medium",disabled:"look"==e.$route.query.type,"no-match-text":"查询无结果","no-data-text":"暂无数据","popper-class":"stratList decision"},model:{value:t.decision,callback:function(i){e.$set(t,"decision",e._n(i))},expression:"item.decision"}},e._l(e.decisionList,function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})}))],1)})],2),e._v(" "),i("div",{staticClass:"parallelForm_bd mg_t_20"},[i("policyItem",{ref:"policyItem",attrs:{classifyForm:e.parallelForm,variableListUml:e.variableList,ruleTmplListUml:[],vLock:e.vLock},on:{classify_plus:e.classify_plus,classify_remove:e.classify_remove,stratAdd:e.stratAdd}})],1),e._v(" "),i("div",{staticClass:"text-center mg_t_20"},["look"!=e.$route.query.type?i("el-button",{attrs:{type:"primary",size:"medium"},on:{click:function(t){e.bindParallel()}}},[e._v("保存\n            ")]):e._e()],1)],1),e._v(" "),i("router-view",{attrs:{variableListUml:e.variableList,variableList:e.variableList,icon:e.icon},on:{createStratSuccess:e.pushStrat,createRuleSuccess:e.pushRule,getVarType:e.getVarType}})],1)},staticRenderFns:[]};var u=i("C7Lr")(p,c,!1,function(e){i("YvKs")},null,null);t.default=u.exports}});