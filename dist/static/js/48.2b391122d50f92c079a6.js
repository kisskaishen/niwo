webpackJsonp([48],{"1mEt":function(e,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=s("aA9S"),t=s.n(a),o=s("3cXf"),l=s.n(o),n={name:"pages_flowClassifyForm",data:function(){return{loading:!0,pageName:"pages_classifyForm",show:{},rules:{},classifyForm:{nodeId:"",nodeName:"",categoryName:"分类器",policyList:[]},vLock:!1,isNewNode:!0,variableList:[],ruleTmplList:[],oprList:[{id:1,name:"="},{id:2,name:"!="},{id:3,name:"is null"},{id:4,name:">"},{id:5,name:">="},{id:6,name:"<"},{id:7,name:"<="},{id:8,name:"startsWith"},{id:9,name:"contains"}],oprList_str:[{id:1,name:"="},{id:2,name:"!="},{id:3,name:"is null"},{id:8,name:"startsWith"},{id:9,name:"contains"}],oprList_num:[{id:1,name:"="},{id:2,name:"!="},{id:4,name:">"},{id:5,name:">="},{id:6,name:"<"},{id:7,name:"<="}],oprList_bl:[{id:"1",name:"是"},{id:"0",name:"否"}]}},props:["variableListUml","ruleTmplListUml"],components:{policyItem:s("+5dV").a},created:function(){this.variableList=this.variableListUml,this.ruleTmplList=this.ruleTmplListUml,this.getClassifyNode()},methods:{classify_plus:function(e){this.classifyForm.policyList.splice(e+1,0,{appId:"",id:"",policyName:"",logic:"",ruleList:[{id:"",ruleName:"",decisionCode:"",logic:"",ruleConShow:!0,ruleContent:[{variableId:"",variableName:"",variableType:"",logic:1,oprList:[],operationArray:[],content:[{operation:"",operationValue:"",valueDescription:"",sort:""}]}]}],policyShow:!0})},classify_remove:function(e,i){jsPlumb.getConnections().length&&jsPlumb.getConnections().some(function(i){jsPlumb.getConnections().map(function(e){e.canvas.dataset.bdcolor=""});var s=i.canvas.dataset.linevalue&&i.canvas.dataset.linevalue==e.id;return s&&(i.canvas.dataset.bdcolor="red"),s})?this.$notify({message:"删除失败，请先删除分类线条。",type:"warning"}):(this.classifyForm.policyList.splice(i,1),this.classifyForm.policyList.length<1&&(this.classify_plus(e,i),!e.policyName&&this.$notify({message:"不能再删了",type:"warning"})))},validateClassifyForm:function(){var e=this;this.vLock=!0;var i=this.classifyForm.policyList.filter(function(i){var s=!i.policyShow||e.$refs.policyItem.validateStrat(i);return i.policyName&&s}).length;return console.log("完整Classify",i,"所有Classify",this.classifyForm.policyList.length),!!this.classifyForm.categoryName&&i==this.classifyForm.policyList.length},reNameLineLable:function(e){jsPlumb.getConnections().map(function(i){i.canvas.dataset.linevalue==e.id&&(i.canvas.dataset.des=e.policyName,i.getOverlay("label").setLabel(e.policyName))})},bindCategory:function(){var e=this,i=JSON.parse(l()(this.classifyForm));if(console.log(i),i.nodeId=this.$route.query.nodeId.slice(4),i.policyList.map(function(e,i){e.ruleList.map(function(e,i){e.id=""})}),this.validateClassifyForm()){this.$post("/mcs/node/category/bind",i).then(function(s){e.$message.success("绑定成功"),i.nodeName=e.classifyForm.categoryName,i.nodeId=e.$route.query.nodeId,e.$emit("saveForm",i),e.resetClassifyForm()})}else{var s="";i.policyList.map(function(e){s=""==e.policyName?"已有变量名":""==e.logic?"逻辑运算符":"信息"}),this.$notify({message:"分类器"+s+"必填",type:"warning",customClass:"pos-classifyForm"})}},resetClassifyForm:function(){this.classifyForm={categoryName:"",policyList:[]},this.classify_plus(),this.vLock=!1},updateLineValue:function(e,i){var s=this;e&&(i.policyList.map(function(i,s){e.policyList[s]&&(i.oldId=e.policyList[s].id)}),jsPlumb.getConnections().map(function(e){i.policyList.map(function(i,a){console.log(a,e.canvas.dataset.linevalue,i.oldId),e.canvas.dataset.linevalue==i.oldId&&(console.log("【更新线条ID】","现:",e.canvas.dataset.linevalue,"缓存:",i.oldId,"新:",i.id),e.canvas.dataset.linevalue=i.id,s.ajaxPush.updateLine(e))}),"1"==e.canvas.dataset.selected&&(s.$route.query.lineValue=e.canvas.dataset.linevalue)}))},getClassifyNode:function(){var e=this;this.$post("/mcs/node/category/query",{nodeId:this.$route.query.nodeId.slice(4)}).then(function(i){i&&i.policyList?(i.policyList.map(function(i){i.policyShow=!1,i.ruleList.map(function(i,s){i.ruleConShow=!1,i.ruleContent.map(function(i,s){i.sort=s,i.operationArray=i.content.map(function(e){return e.operationValue}),i.oprList=[],e.getVarType(i,s,0)}),i.isTemplate||(i.id=i.ruleName)})}),t()(e.classifyForm,i)):e.classify_plus();var s=JSON.parse(l()(e.classifyForm));s.nodeName=e.classifyForm.categoryName,s.nodeId=e.$route.query.nodeId,s.clear=!i,e.$emit("firstBindPush",s),e.loading=!1})},pushStrat:function(e){this.classifyForm.policyList=this.classifyForm.policyList.filter(function(e){return!!e.policyName}),this.classifyForm.policyList.push(e),this.$router.push({path:"/risk/proMg/businessList/editFlow/classifyForm",query:this.$route.query})},getVarType:function(e,i,s){var a=this;this.variableList.map(function(t){e.variableId==t.variableId&&(e.variableName=t.variableName,e.variableType=t.variableType,1==t.variableType?e.oprList=a.oprList_str:2==t.variableType||3==t.variableType||4==t.variableType?e.oprList=a.oprList_num:5==t.variableType?a.getOprList_enumList(e,i,s):6==t.variableType?e.oprList=a.oprList_bl:a.$notify({message:"未知变量",type:"warning"}))})},getOprList_enumList:function(e,i,s){this.$post("/mcs/variable/enums",{variableId:e.variableId}).then(function(i){i.enumList.map(function(e){e.id=e.enumValue,e.name=e.enumName}),e.oprList=i.enumList})}}},r={render:function(){var e=this,i=e.$createElement,s=e._self._c||i;return s("div",{staticClass:"pages_classifyForm"},[s("el-form",{staticClass:"classifyForm",attrs:{model:e.classifyForm,"status-icon":"",rules:e.rules}},[s("el-form-item",{attrs:{label:""}},["look"==e.$route.query.type?s("div",{staticClass:"w300 overhide"},[e._v("\n                "+e._s(e.classifyForm.categoryName)+"\n            ")]):s("el-input",{staticClass:"w310",class:{solid_red:e.vLock&&!e.classifyForm.categoryName},attrs:{placeholder:"请输入分类器名称",size:"medium",clearable:""},model:{value:e.classifyForm.categoryName,callback:function(i){e.$set(e.classifyForm,"categoryName",i)},expression:"classifyForm.categoryName"}})],1),e._v(" "),s("div",{staticClass:"defaultClassify mg_b_20"},[e._v("默认分类：其他")]),e._v(" "),s("div",{staticClass:"classifyForm_bd"},[s("policyItem",{ref:"policyItem",attrs:{classifyForm:e.classifyForm,vLock:e.vLock,variableListUml:e.variableList,ruleTmplListUml:e.ruleTmplList},on:{classify_plus:e.classify_plus,classify_remove:e.classify_remove}})],1),e._v(" "),s("div",{staticClass:"mg_t_20"},["look"!=e.$route.query.type?s("el-button",{attrs:{type:"primary",size:"medium"},on:{click:function(i){e.bindCategory()}}},[e._v("保存\n            ")]):e._e()],1)],1),e._v(" "),s("router-view",{attrs:{variableListUml:e.variableList,ruleTmplListUml:e.ruleTmplList},on:{createStratSuccess:e.pushStrat}})],1)},staticRenderFns:[]};var c=s("C7Lr")(n,r,!1,function(e){s("Ooj7")},null,null);i.default=c.exports},Ooj7:function(e,i){}});