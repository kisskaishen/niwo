webpackJsonp([33],{gy7S:function(e,s,i){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var t=i("3cXf"),l=i.n(t),a=i("aA9S"),n=i.n(a),o={name:"pages_selectClassify",data:function(){return{pageName:"pages_selectClassify",selectClassify:{nodeId:"",lineId:"",lineValue:"",valueDescription:"",categoryName:"",policyList:[],nodetype:"line"}}},components:{noData:i("VGsm").a},created:function(){this.selectClassify.nodeId=this.$route.query.nodeId,this.selectClassify.lineId=this.$route.query.lineId,this.getClassifyNode()},methods:{initLineForm:function(){var e=this;if(this.$route.query.lineValue&&"undefined"!=this.$route.query.lineValue){this.selectClassify.lineValue=1*this.$route.query.lineValue;var s=this.selectClassify.policyList.filter(function(s){return e.$route.query.lineValue==s.id})[0].policyName;this.selectClassify.valueDescription=s}},hasRepeatClassify:function(e){var s=this,i=[];jsPlumb.getConnections().map(function(e){e.sourceId.slice(4)==s.$route.query.nodeId&&i.push(e)}),console.log("当前节点的连线",i,"所有分类",e.policyList),i.map(function(i,t){console.log("点击线",s.$route.query.lineValue,"线"+t+"："+i.canvas.dataset.linevalue),i.canvas.dataset.linevalue&&s.$route.query.lineValue!=i.canvas.dataset.linevalue&&(e.policyList=e.policyList.filter(function(e){return e.id!=i.canvas.dataset.linevalue}))})},updateLineValue:function(e,s){var i=this;e&&(s.policyList.map(function(s,i){e.policyList[i]&&(s.oldId=e.policyList[i].id)}),jsPlumb.getConnections().map(function(e){s.policyList.map(function(s,t){e.canvas.dataset.linevalue==s.oldId&&(e.canvas.dataset.linevalue=s.id,i.ajaxPush.updateLine(e))}),"1"==e.canvas.dataset.selected&&(i.$route.query.lineValue=e.canvas.dataset.linevalue)}))},getClassifyNode:function(){var e=this;this.$post("/mcs/node/category/query",{nodeId:this.selectClassify.nodeId}).then(function(s){s&&(s.policyList.map(function(e){e.policyShow=!1,e.ruleList=[]}),s.policyList.push({id:-1,policyName:"其他"}),n()(e.selectClassify,s),e.initLineForm(),e.hasRepeatClassify(e.selectClassify)),e.selectClassify.clear=!s;var i=JSON.parse(l()(e.selectClassify));e.$emit("firstBindLine",i)})},clearRadio:function(e,s,i){this.selectClassify.lineValue==e.id&&(console.log("清除选中",e,s),this.selectClassify.lineValue="",this.selectClassify.valueDescription="")},changeRadio:function(e,s){e?(console.log("选择分类",e,s+1),this.selectClassify.valueDescription=e.policyName):(console.log("选择其他"),this.selectClassify.valueDescription="其他")},saveSelectClassify:function(){var e=JSON.parse(l()(this.selectClassify));this.$emit("saveForm",e)},saveSelectClassify0:function(){var e=this;this.$post("/mcs/node/line/update",{id:this.selectClassify.lineId,lineValue:this.selectClassify.lineValue,valueDescription:this.selectClassify.valueDescription}).then(function(s){e.$emit("saveForm",e.selectClassify)})}}},c={render:function(){var e=this,s=e.$createElement,i=e._self._c||s;return i("div",{staticClass:"pages_selectClassify pd_t_20"},[e.selectClassify.policyList.length?i("el-form",{ref:"selectClassify",staticClass:"selectClassify",attrs:{model:e.selectClassify,"status-icon":""}},[i("el-form-item",{staticClass:"classifyItem",attrs:{label:"look"==e.$route.query.type?"分类：":"请选择分类：",prop:"lineValue"}},[i("el-radio-group",{model:{value:e.selectClassify.lineValue,callback:function(s){e.$set(e.selectClassify,"lineValue",e._n(s))},expression:"selectClassify.lineValue"}},e._l(e.selectClassify.policyList,function(s,t){return"look"!=e.$route.query.type||e.selectClassify.lineValue==s.id?i("el-radio",{key:t,attrs:{label:s.id},on:{change:function(i){e.changeRadio(s,t)}},nativeOn:{click:function(i){e.clearRadio(s,t)}}},[e._v(e._s(s.policyName))]):e._e()}))],1),e._v(" "),"look"!=e.$route.query.type?i("div",{staticClass:"text-center"},[i("el-button",{attrs:{type:"primary",size:"medium"},on:{click:e.saveSelectClassify}},[e._v("保存")])],1):e._e()],1):i("noData",{attrs:{img:"noData",p2:"暂无配置分类"}})],1)},staticRenderFns:[]};var u=i("C7Lr")(o,c,!1,function(e){i("udea")},null,null);s.default=u.exports},udea:function(e,s){}});