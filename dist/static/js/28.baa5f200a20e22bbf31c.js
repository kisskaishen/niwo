webpackJsonp([28],{"/30j":function(e,t){},"/7hl":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=o("3cXf"),i=o.n(s),a={name:"pages_kingForm",data:function(){return{loading:!1,pageName:"添加冠军/挑战者",kingData:[],scoreKingData:[]}},created:function(){},mounted:function(){"1"==this.$route.query.moldType?"{}"!=i()(this.$local.get("policyList"))?(this.kingData=this.$local.get("policyList"),console.log(this.kingData)):(this.kingData.push({policyName:"新建策略",rate:""}),this.getList()):"3"==this.$route.query.moldType&&("{}"!=i()(this.$local.get("scoreList"))?this.scoreKingData=this.$local.get("scoreList"):this.getList())},methods:{getList:function(){var e=this,t="";"1"==this.$route.query.moldType?t="/mcs/node/policy/query":"3"==this.$route.query.moldType&&(t="/mcs/node/mold/query"),this.$post(t,{nodeId:this.$route.query.nodeId.slice(4)}).then(function(t){null!=t&&("1"==e.$route.query.moldType?(e.kingData=t.policyList?t.policyList:[],e.$local.set("policyList",t.policyList)):t.bindMoldList.length>0?(e.scoreKingData=t.bindMoldList,e.$local.set("scoreList",t.bindMoldList)):e.scoreKingData=[{scorecardName:"评分卡模型",rate:""}]),e.loading=!1})},addCeLue:function(){"1"==this.$route.query.moldType?this.kingData.push({policyName:"新建策略",rate:""}):"3"==this.$route.query.moldType&&this.scoreKingData.push({scorecardName:"评分卡模型",rate:""})},deleteCeLue:function(e){"1"==this.$route.query.moldType?(this.kingData.splice(e.$index,1),this.$local.set("policyList",this.kingData)):"3"==this.$route.query.moldType&&(this.scoreKingData.splice(e.$index,1),this.$local.set("scoreList",this.scoreKingData))},newCeLue:function(e){switch(parseInt(this.$route.query.moldType)){case 1:this.$router.push({path:this.$route.fullPath.replace("/kingForm","/stratForm"),query:{from:"kingForm",policyId:e.row.policyId}}),this.$local.set("formIndex",e.$index+1);break;case 3:this.$router.push({path:this.$route.fullPath.replace("/kingForm","/scoreCardForm"),query:{from:"kingForm"}}),void 0==e.row.id?this.$local.delete("scoreListId"):this.$local.set("scoreListId",e.row.id),this.$local.set("formIndex",e.$index+1)}},saveBtn:function(){var e=this;"1"==this.$route.query.moldType?(this.kingData.map(function(t,o,s){""==t.policyName||""==t.rate?e.$message.error("保存失败，配置内容不全"):t.rate<=0?e.$message.error("流量值必须大于0"):t.rate>1&&e.$message.error("流量值不能大于1")}),this.$post("/mcs/node/policy/bind",{nodeId:this.$route.query.nodeId.slice(4),policyList:this.kingData}).then(function(t){e.$message.success("添加成功"),e.$local.delete("policyList"),setTimeout(function(){location.reload()},300)})):(console.log(this.scoreKingData),this.scoreKingData.map(function(t,o,s){t.bindId||(t.bindId=t.id,t.bindName=t.moldName),""==t.scorecardName||""==t.rate&&0!=t.rate?e.$message.error("保存失败，配置内容不全"):t.rate<=0&&e.$message.error("流量值必须大于0")}),this.$post("/mcs/node/mold/bind",{nodeId:this.$route.query.nodeId.slice(4),bindMoldList:this.scoreKingData}).then(function(t){e.$message.success("添加成功"),e.$local.delete("scoreList"),setTimeout(function(){location.reload()},300)}))}},beforeRouteUpdate:function(e,t,o){var s=e.query.nodeId,i=t.query.nodeId;console.log(s,i),o()},beforeDestroy:function(){this.$bus.$off("getContent")}},r={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"pages_kingForm"},[o("h2",[e._v(e._s(e.pageName))]),e._v(" "),"1"==e.$route.query.moldType?o("el-table",{attrs:{data:e.kingData,"header-row-class-name":"table_hd","header-cell-class-name":"table_th","row-class-name":"table_tr","cell-class-name":"table_td"}},[o("el-table-column",{attrs:{prop:"text",label:"策略"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("p",{staticClass:"name primaryColor",on:{click:function(o){e.newCeLue(t)}}},[e._v(e._s(t.row.policyName))]),e._v(" "),"edit"==e.$route.query.type?o("div",{staticClass:"iconDiv"},[o("i",{staticClass:"el-icon-circle-plus-outline",on:{click:function(o){e.addCeLue(t)}}}),e._v(" "),e.kingData.length>1?o("i",{staticClass:"el-icon-delete",on:{click:function(o){e.deleteCeLue(t)}}}):e._e()]):e._e()]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"number",label:"流量"},scopedSlots:e._u([{key:"default",fn:function(t){return["look"==e.$route.query.type?o("p",[e._v(e._s(t.row.rate))]):o("el-input",{attrs:{maxLength:"4",size:"mini",placeholder:"支持两位小数"},model:{value:t.row.rate,callback:function(o){e.$set(t.row,"rate",e._n(o))},expression:"scope.row.rate"}})]}}])})],1):e._e(),e._v(" "),"3"==e.$route.query.moldType?o("el-table",{attrs:{data:e.scoreKingData,"header-row-class-name":"table_hd","header-cell-class-name":"table_th","row-class-name":"table_tr","cell-class-name":"table_td"}},[o("el-table-column",{attrs:{prop:"text",label:"评分卡"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("p",{staticClass:"name primaryColor",on:{click:function(o){e.newCeLue(t)}}},[e._v("\n                    "+e._s(t.row.scorecardName||t.row.bindName))]),e._v(" "),"edit"==e.$route.query.type?o("div",{staticClass:"iconDiv"},[o("i",{staticClass:"el-icon-circle-plus-outline",on:{click:function(o){e.addCeLue(t)}}}),e._v(" "),e.scoreKingData.length>1?o("i",{staticClass:"el-icon-delete",on:{click:function(o){e.deleteCeLue(t)}}}):e._e()]):e._e()]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"number",label:"流量"},scopedSlots:e._u([{key:"default",fn:function(t){return["look"==e.$route.query.type?o("p",[e._v(e._s(t.row.rate))]):o("el-input",{attrs:{maxLength:"4",size:"mini",placeholder:"支持两位小数"},model:{value:t.row.rate,callback:function(o){e.$set(t.row,"rate",e._n(o))},expression:"scope.row.rate"}})]}}])})],1):e._e(),e._v(" "),"1"==e.$route.query.moldType?o("p",{staticStyle:{"margin-bottom":"40px",color:"#ccc"}},[e._v("\n        注：当仅含1个策略元件且流量=1，即代表该策略无挑战者")]):e._e(),e._v(" "),"3"==e.$route.query.moldType?o("p",{staticStyle:{"margin-bottom":"40px",color:"#ccc"}},[e._v("\n        注：当仅含1个评分卡元件且流量=1，即代表该评分卡无挑战者")]):e._e(),e._v(" "),"edit"==e.$route.query.type?o("el-button",{attrs:{type:"primary"},on:{click:e.saveBtn}},[e._v("保存")]):e._e()],1)},staticRenderFns:[]};var l=o("C7Lr")(a,r,!1,function(e){o("/30j")},null,null);t.default=l.exports}});